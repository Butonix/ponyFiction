# Справка по разработке

Для корректной работы приложения необходимо несколько сервисов.
Управление ими реализовано с помощью vagga (user-space контейнеризатора; впрочем, можно использовать и Docker)

## Процесс разворачивания рабочего окружения

_Пример дан для **Ubuntu 14.04 LTS**_

1. Установка vagga; подробнее — см. на [странице документации Vagga](http://vagga.readthedocs.org/en/latest/installation.html#ubuntu)
2. Клонирование репозитория:

    `git clone https://github.com/RuFimFiction/ponyFiction.git`

    `cd ponyFiction`

    Все последующие команды вызываются из директории ponyFiction

3. Заполнение базы данных
    * Скачивание дампа базы: `wget SOME_HOST/trunk.sql.gz`
    * Инициализация и загрузка дампа базы данных: `vagga db_init trunk.sql.gz`

4. Запуск и донастройка:

    * В отдельном терминале запускаем stories командой `vagga run` (должно быть запущено для следующих шагов)
    и дожидаемся окончания сборки контейнеров (при первом запуске) до появления сообщения `celery@hostname ready`
    * `vagga manage.py collectstatic --noinput` для подготовки статических файлов админки
    * `vagga manage.py createsuperuser` для создания админа
    * `vagga manage.py initsphinx` для заполнения индекса поиска
    * Заходим на http://127.0.0.1:8000 и проверяем, что всё работает

## Запуск сервисов

_Перед началом работы весьма полезно прочесть [справку](http://vagga.readthedocs.org/en/latest/commandline.html)_

Запуск всех составных частей stories из терминала следующими командами:
```
cd ponyFiction
vagga run
```
Чтобы завершить запущенное, достаточно нажать Ctrl+C в том терминале, где оно запущено.

Для запуска только указанных сервисов из стека — `vagga run --only <service1> (<service2> …)`, например, `vagga run --only nginx`

Иногда для отладки бывает полезно исключить какой-то сервис из стека и запустить его отдельно в консоли. 
Чаще всего это касается приложения. Для этого — `vagga run --exclude uwsgi`
