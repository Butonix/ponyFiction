{% extends "common.html" %}
{% load url from future %}
{% load pluralize %}
{% block content %}
{% load static %}

<div class="row welcome-box">
  <div class="span12 genra">
	{% spaceless %}
    {% for category in categories %}
		<a class="gen gen-{{ category.id }}" href="{% url 'search_simple' 'category' category.id %}">{{ category.name }}</a>
    {% endfor %}
	{% endspaceless %}
  </div>
</div>
    
<div class="row">
	<div class="span8 top-list">
		<h2>Новые добавления</h2>
			{% for story in stories %}
				<div class="story-item">
					<h3><a href="{% url 'story_view' story.id %}">{{ story.title }}</a> 
          			<sup><span class="upvotes">{{ story.vote_up_count }}</span> / <span class="downvotes">{{ story.vote_down_count }}</span></sup></h3>
					<p class="meta">
	          			{% spaceless %}
							<span class="category-list">
		           				{% for category in story.categories.all %}
		           					<a class="gen gen-{{ category.id }}" href="{% url 'search_simple' 'category' category.id %}">{{ category.name }}</a>
		           				{% endfor %}
		         			 </span>
		        		{% endspaceless %}
	          			{{ story.words|rupluralize:'слово,слова,слов' }} от 
			          	{% for author in story.authors.all %}
				            {% if forloop.counter == 1 %}
				              <a class="authorlink" href="{% url 'author_overview' author.id %}">{{author.username}}</a>
				                {% if story.authors.all.count > 1 %}(в соавторстве с{% endif %}
				              {% endif %}
				                {% if forloop.counter > 1 %}           	        	
				              <a class="authorlink" href="{% url 'author_overview' author.id %}">{{author.username}}</a>{% if forloop.revcounter0 == 1 %} и {% endif %}{% if forloop.revcounter0 > 1 %}, {% endif %}
				            {% endif %}
				              {% if forloop.revcounter0 == 0 and story.authors.all.count > 1 %}){% endif %}
			            {% endfor %}
					</p>
					<p>{{ story.summary }}</p>
					<p class="meta">
						{% spaceless %}
            				<span class="character-list">
            					{% for character in story.characters.all %}
              						<a href="{% url 'search_simple' 'character' character.id %}"><img src="{% get_static_prefix %}i/characters/{{ character.id }}.png" alt="{{ character.name }}" title="{{ character.name }}"/></a>
            					{% endfor %}
           					</span>
         				{% endspaceless %}
          			</p>
				</div>
			{% endfor %}
		<p class="more"><a href="{% url 'stream_stories' %}">Лента добавлений</a> | <a href="#">RSS</a></p>
	</div>

	<div class="span4 sidelist top-list">
		
		<h2>Обновившиеся рассказы</h2>
        {% for chapter in chapters %}
			<div class="story-item">
				<h3><a href="{% url 'chapter_view_single' chapter.in_story_id chapter.order %}">{{ chapter.title }}</a></h3>
          		<p><a href="{% url 'story_view' chapter.in_story_id %}">{{ chapter.in_story.title }}</a> от <a class="authorlink" href="{% url 'author_overview' chapter.in_story.authors.all.0.id %}">{{ chapter.in_story.authors.all.0.username }}</a> {{ chapter.date|timesince }} назад</p>
        	</div>
		{% endfor %}
		<p class="more"><a href="{% url 'stream_chapters' %}">Лента обновлений</a> | <a href="#">RSS</a></p>
		
        <h2>Последние комментарии</h2>
		{% for comment in comments %}
			<div class="story-item">
				<p class="comment"> {{ comment.text|truncatewords_html:12|removetags:"br"|safe }}</p>
				<p>{{ comment.date|timesince }} назад <a class="authorlink" href="{% url 'author_overview' comment.author_id %}">{{ comment.author.username }}</a> о <a href="{% url 'story_view' comment.in_story_id %}"><b>{{ comment.in_story.title }}</b></a></p>
			</div>
		{% endfor %}
		<p class="more"><a href="{% url 'stream_comments' %}">Лента комментариев</a></p>

		</div>
	</div>
{% endblock %}